
-- Creation de la table film 
create table film
--notes: besoin de rajouter des accents car ils ne sont pas acceptés dans les noms des attributs. table jointe
(
	id_film INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
	titre VARCHAR NOT NULL,
	genre VARCHAR,
	duree INTEGER,
	realisateur VARCHAR,
	date_sortie VARCHAR,
	note INTEGER
);

-- Remplissage de la table film 
INSERT INTO film 
(titre, genre, duree, realisateur, date_sortie, note)
SELECT DISTINCT 
	titre,
	genre,
	duree,
	realisateur,
	annee_sortie AS date_sortie,
	note_sur_100
FROM TMP_wiki1 
where titre is not null

UNION

SELECT DISTINCT 
	titre,
	genre,
	duree,
	realisateur,
	annee_sortie AS date_sortie,
	note_sur_100
FROM TMP_wiki2
where titre is not null;

--Création de la table aire_geographique 

create table aire_geographique
(
	id_aire_geographique INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
	commune VARCHAR NOT NULL,
	code_insee VARCHAR NOT NULL,  
	code_departement VARCHAR NOT NULL,
	region INTEGER NOT NULL,
	nom_region VARCHAR,   
	type_rsa VARCHAR,
	nb_foyers INTEGER,
	nb_personnes INTEGER
);

--Remplissage de la table aire_geographique
insert into aire_geographique 
(commune, code_insee, code_departement, region, nom_region, type_rsa,
nb_foyers, nb_personnes)
select distinct 
	a.commune, 
	a.code_insee, 
	a.departement as code_departement, 
	a.region_cnc as region,
	a.region_administrative as nom_region,
	b.type_rsa,
	b.nbr_foyer_rsa as nb_foyers, 
	b.nbr_pers_rsa as nb_personnes
from tmp_cnc a
left join tmp_rsa b on a.commune = b.commune;

--Création de la table utilisateur

create table utilisateur
(
	id_utilisateur INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY PRIMARY KEY
);

À VOIR APRÈS AVEC BÉATRICE !! 

--Création de la table cinema 
create table cinema
(
	id_cinema INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
	id_aire_geographique INTEGER,
	nom_cinema VARCHAR NOT NULL,
	adresse VARCHAR,
	commune VARCHAR, 
	longitude REAL,
	latitude REAL,
	numero_uu VARCHAR,
	ecrans INTEGER,
	fauteuils INTEGER,
	FOREIGN KEY (id_aire_geographique) REFERENCES aire_geographique(id_aire_geographique)
);

--remplissage de la table "cinema"

INSERT INTO cinema
(nom_cinema, adresse, commune, longitude, latitude, numero_uu, ecrans, fauteuils)
SELECT DISTINCT 
	nom_cinema, 
	adresse, 
	commune,
	longitude,
	latitude,
	n_uu AS numero_uu, 
	ecrans,
	fauteuils
FROM tmp_cnc ; 

create table seance

(
	id_seance INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
	id_film INTEGER,
	id_cinema INTEGER,
	debut DATE,
	fin DATE,
	sous_titres BOOLEAN,
	version VARCHAR,
	nb_places INTEGER,
	FOREIGN KEY (id_film) REFERENCES film(id_film),
	FOREIGN KEY (id_cinema) REFERENCES cinema(id_cinema)
);


