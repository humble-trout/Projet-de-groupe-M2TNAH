-- Création de tables jointes: création des tables dont les données proviendront de différentes sources

--reprise du même schéma
SET search_path TO psch;

BEGIN ;

CREATE DATABASE planseance;

create table film
--notes: besoin de rajouter des accents car ils ne sont pas acceptés dans les noms des attributs. table jointe
(
	id_film INTEGER NOT NULL PRIMARY KEY,
	titre VARCHAR NOT NULL,
	affiche VARCHAR,
	genre VARCHAR,
	duree INTEGER,
	distribution VARCHAR,
	realisateur VARCHAR,
	synopsis TEXT,
	bande_annonce VARCHAR,
	note INTEGER
);

create table aire_geographique
--notes:  je préfère supprimer les accents des noms des tables. table jointe
(
	id_aire_geographique INTEGER NOT NULL PRIMARY KEY,
	commune varchar not null,
	type_rsa varchar,
	nb_foyers int,
	nb_personnes int,
	region int not null,
	--intérêt de region et nom_region séparés?
	nom_region varchar not null,
	nom_departement varchar not null,
	code_departement integer not null
)
;

create table frequentation
--notes: FOREIGN KEY ne fonctionne pas tant que cinema n'est pas créé mais cinema a besoin de frequentation pour être créé: problème. table jointe
(
	id_frequentation INTEGER NOT NULL PRIMARY KEY,
	id_cinema INTEGER NOT NULL,
	evolution_entrees INTEGER,
	entrees_2021 INTEGER,
	entrees_2022 INTEGER,
	entrees_2023 INTEGER,
	entrees_2024 INTEGER
	--FOREIGN KEY (id_cinema) REFERENCES cinema(id_cinema)
);

create table programmation_cinema
--notes: table non jointe
(
	id_programmation INTEGER NOT NULL PRIMARY KEY,
	id_cinema INTEGER NOT NULL,
	art_et_essai BOOL,
	nb_films_inedits INTEGER,
	nb_films_programmes INTEGER,
	pdm_fr INTEGER,
	pdm_us INTEGER,
	pdm_ue INTEGER,
	pdm_autres_films INTEGER,
	pdm_art_et_essai INTEGER
	--FOREIGN KEY (id_cinema) REFERENCES cinema(id_cinema)
);

create table seance
--notes: table jointe (?)
(
	id_seance INTEGER NOT NULL PRIMARY KEY,
	id_film integer not null,
	id_cinema INTEGER NOT NULL,
	debut date,
	fin date,
	--"end" est un mot clé SQL et ne marche pas en nom d'attribut. j'ai aussi modifié "start" en "debut"
	ST boolean,
	version varchar,
	nb_places integer
	--FOREIGN KEY (id_film) REFERENCES film(id_film)
	--FOREIGN KEY (id_cinema) REFERENCES cinema(id_cinema)
)
;

create table cinema
--notes: table jointe
(
	id_cinema INTEGER NOT NULL PRIMARY KEY,
	id_frequentation integer not null,
	id_programmation INTEGER NOT NULL,
	id_aire_geographique integer not null,
	nom_cinema varchar not null,
	adresse varchar,
	longitude real,
	latitude real,
	numero_uu int,
	--° n'est pas accepté dans le nom d'un attribut
	ecrans int,
	fauteuils int,
	capacite_totale int
	--FOREIGN KEY (id_frequentation) REFERENCES film(id_frequentation),
	--FOREIGN KEY (id_programmation) REFERENCES cinema(id_programmation),
	--FOREIGN KEY (id_aire_geographique) REFERENCES cinema(id_aire_geographique)
)
;

--création de tables qui ne sont je pense pas concernées par cet exercice mais sont sur le modèle donc je les inclus quand même?

create table utilisateur
(
	id_utilisateur INTEGER NOT NULL PRIMARY key
	--à remplir
)
;

create table calendrier
(
	id_utilisateur INTEGER NOT null,
	id_seance integer not null
	--FOREIGN KEY (id_utilisateur) REFERENCES utilisateur(id_utilisateur),
	--FOREIGN KEY (id_seance) REFERENCES seance(id_seance)
)
;

create table cinema_favori
(
	id_utilisateur INTEGER NOT null,
	id_cinema integer not null
	--FOREIGN KEY (id_utilisateur) REFERENCES utilisateur(id_utilisateur),
	--FOREIGN KEY (id_cinema) REFERENCES cinema(id_cinema)
)
;

-- Fin du script
COMMIT ;

